<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Installation and configuration - Butler documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Installation and configuration";
    var mkdocs_page_input_path = "install-config.md";
    var mkdocs_page_url = "/install-config/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-58487795-2', 'mountaindude.github.io/butler');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Butler documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../overview/">Overview and features</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../getting-started/">Getting started</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../project-layout/">Project layout</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Installation and configuration</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#requirements">Requirements</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#windows_or_osx">Windows or OSX</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#installation">Installation</a></li>
    

    <li class="toctree-l2"><a href="#security_considerations">Security considerations</a></li>
    

    <li class="toctree-l2"><a href="#configuration">Configuration</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#config_file_syntax">Config file syntax</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#log4net_extender_config_files">log4net extender config files</a></li>
    

    <li class="toctree-l2"><a href="#customisation">Customisation</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../running/">Running Butler</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Features</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../rest/">REST API</a>
                </li>
                <li class="">
                    
    <a class="" href="../log-events/">Log event handlers</a>
                </li>
                <li class="">
                    
    <a class="" href="../real-time/">Real time metrics</a>
                </li>
                <li class="">
                    
    <a class="" href="../mqtt/">MQTT integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../udp-client/">UDP client</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../sample-code/">Examples</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../security/">Security considerations</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../tools-used/">Tools used</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Butler documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Installation and configuration</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ptarmiganlabs/butler/edit/master/docs/install-config.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h1>
<p>Butler depends on various pieces of software. Some are required, others are optional, as described below.</p>
<table>
<thead>
<tr>
<th>What</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sense Enterprise</td>
<td>Butler is developed with Sense Enterprise in mind. While many Butler features might also work with Sense Desktop, you are on your own there.</td>
</tr>
<tr>
<td>MQTT broker</td>
<td>MQTT is used for both in- and out-bound pub-sub messaging. Butler assumes a working MQTT broker is available, the IP of which is defined in the Butler config file. Mosquitto is a nice open source broker. It requires very little hardware to run, even the smallest (free!) Amazon EC2 instance is enough, if you want a dedicated MQTT server. If you don't care about the pubsub features of Butler, you obviously don't need a MQTT broker.</td>
</tr>
<tr>
<td>node.js</td>
<td>Butler is written in Node - which is thus a firm requirement.</td>
</tr>
</tbody>
</table>
<h2 id="windows_or_osx">Windows or OSX<a class="headerlink" href="#windows_or_osx" title="Permanent link">&para;</a></h2>
<p>While Sense is a Windows only system, Butler should be able to run on any OS where node.js is available.<br />
Butler has been succesfully used - both during development and production use - on Windows, Linux (Debian and Ubuntu tested) and OSX.</p>
<h1 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h1>
<p>Below are the general steps needed to install Butler. Please note that you might need to adapt these to your particular system configuration.   </p>
<ul>
<li>
<p><strong>Install node.js</strong><br />
  Butler has been developed and tested using the 64 bit version of <a href="https://nodejs.org/en/download/">node.js</a> 4.4.6.   </p>
</li>
<li>
<p><strong>Decide where to install Butler</strong><br />
  It is usually a good starting point to run Butler on the Sense server. If there are more than one server in the Sense cluster, Butler can be placed on the reload server (as the /createDir endpoint then can be used to create folders in which QVD and other files can be stored).
  That said, it is quite possible to run Butler on any server, as long as there is network connectivity to the Sense server(s).  </p>
</li>
<li>
<p><strong>Download Butler</strong><br />
  Download the repository zip file or clone the Butler repository using your git tool of choice. Both options achieve the same thing, i.e. a directory such as d:\node\butler, which is then Butler's root directory.  </p>
</li>
<li>
<p><strong>Install node dependencies</strong><br />
  From a Windows command prompt (assuming Butler was installed to d:\node\butler):  </p>
<pre><code>d:
cd \node\butler\src
npm install
</code></pre>
<p>This will download and install all node.js modules used by Butler.  </p>
</li>
<li>
<p><strong>MQTT message broker</strong><br />
Many of Butler's features use <a href="http://mqtt.org/">MQTT</a> for sending and receiving messages.<br />
MQTT is a standardised messaging protocol, and it should be possible to use <a href="https://github.com/mqtt/mqtt.github.io/wiki/software?id=software">any broker following the MQTT standard</a>.  <br />
Butler has been developed and tested using <a href="https://mosquitto.org/">Mosquitto</a> running on OSX and Debian Linux - both work flawlessly.</p>
</li>
<li>
<p><strong>Documentation dependencies</strong><br />
  If you plan to modify or extend Butler's documentation, you will need to install <a href="http://www.mkdocs.org/">MkDocs</a>.<br />
  MkDocs is used to create the pages you are reading right now.</p>
</li>
</ul>
<h1 id="security_considerations">Security considerations<a class="headerlink" href="#security_considerations" title="Permanent link">&para;</a></h1>
<ul>
<li>
<p>You should make sure to configure the firewall of the server where Buter is running, so it only accepts connections from the desired clients/IP addresses.
A reasonable first approach would be to configure the firewall to only allow calls from localhost. That way calls to Butler can only be made from the server where Butler itself is running.</p>
</li>
<li>
<p>As of right now the MQTT connections are not secured by certificates or passwords.
For use within a controlled network that might be fine, but nonetheless something to keep in mind. Adding certificate based authentication (which MQTT supports) would solve this.  </p>
</li>
<li>
<p>Butler uses various node.js modules from <a href="https://www.npmjs.com/">npm</a>. If concerned about security, you should review these dependencies and decide whether there are issues in them or not.<br />
Same thing with Butler itself - while efforts have been made to make Butler secure, you need to decide for yourself whether the level of security is enough for your use case.  </p>
</li>
</ul>
<p>Butler is continuously checked for security vulnerabilities by using <a href="https://snyk.io/">Snyk</a>, with status badges shown in the readme files.</p>
<h1 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h1>
<p>Butler uses configuration files in YAML format. The config files are stored in the src\config folder. Prior to v2.1 JSON config files were used, but as YAML is much more human readable than JSON, a switch was made. JSON config files can still be used, but YAML is the default starting with v2.1.</p>
<p>Butler comes with a default config file called <code>default_template.yaml</code>. Make a copy of it, then rename the copy to <code>default.yaml</code> or <code>production.yaml</code>.<br />
Update it as needed (see below for details).</p>
<p>Trying to run Butler with the default config file (the one included in the files download from GitHub) will not work - you need to adapt it to your server environment.</p>
<p>Note: Butler uses the <a href="https://github.com/lorenwest/node-config">node-config</a> module to handle config files. As per node-config's documentation, to switch to using the production.yaml config file, at a command prompt type (for Windows)</p>
<pre><code>set NODE_ENV=production
</code></pre>
<p>before starting Butler with <code>node butler.js</code>.<br />
  If developing on OSX or Linux, instead use  </p>
<pre><code>export NODE_ENV=production
</code></pre>
<p>You may want to set that variable during server boot, to ensure Butler starts properly when the server is rebooted.</p>
<h2 id="config_file_syntax">Config file syntax<a class="headerlink" href="#config_file_syntax" title="Permanent link">&para;</a></h2>
<p>The <code>default_template.yaml</code> config file looks like this:</p>
<pre><code class="yml">---
Butler:
  slackConfig:
    webhookURL: &lt;fill in your web hook URL from Slack&gt;
    loginNotificationChannel: sense-user-activity
    taskFailureChannel: sense-task-failure
  mqttConfig:
    brokerHost: &lt;FQDN or IP of MQTT server&gt;
    brokerPort: 1883
    taskFailureTopic: qliksense/task_failure
    taskFailureServerStatusTopic: qliksense/butler/task_failure_server
    sessionStartTopic: qliksense/session/start
    sessionStopTopic: qliksense/session/stop
    connectionOpenTopic: qliksense/connection/open
    connectionCloseTopic: qliksense/connection/close
    sessionServerStatusTopic: qliksense/butler/session_server
    activeUserCountTopic: qliksense/users/active/count
    activeUsersTopic: qliksense/users/active/usernames
  udpServerConfig:
    serverIP: &lt;FQDN or IP of server where Butler is running&gt;
    portSessionConnectionEvents: 9997
    portTaskFailure: 9998
  restServerConfig:
    serverPort: 8080
  configEngine:
    engineVersion: 12.20.0        # Qlik Associative Engine version to use with Enigma.js
    server: &lt;FQDN or IP of Sense server where Sense Engine is running&gt;
    serverPort: '&lt;Port to connect to, usually 4747&gt;'
    isSecure: 'true'
    headers:
      X-Qlik-User: UserDirectory=Internal;UserId=sa_repository
    cert: &lt;Path to cert file&gt;
    key: &lt;Path to key file&gt;
    rejectUnauthorized: 'false'
  configQRS:
    authentication: certificates
    host: &lt;FQDN or IP of Sense server where QRS is running&gt;
    useSSL: true
    port: 4242
    headerKey: X-Qlik-User
    headerValue: UserDirectory=Internal; UserId=sa_repository
    cert: &lt;Path to client.pem&gt;
    key: &lt;Path to client_key.pem&gt;
    ca: &lt;Path to root.pem&gt;
  qvdPath: &lt;Path to folder under which QVDs are stored&gt;
  gitHub:
    host: api.github.com
    pathPrefix: ''
</code></pre>

<p>Comments:</p>
<ul>
<li>
<p>Currently Butler assumes that a MQTT broker is present, and that status messages should be sent to Slack. Butler will fail with error messages if it cannot connect to a MQTT server, or if the Slack Webhook URL is not properly set.<br />
Future versions may make MQTT, Slack and other similar channels optional, using the config file.  </p>
</li>
<li>
<p>The default location cert/key files are found in (assuming a standard install of Qlik Sense) C:\ProgramData\Qlik\Sense\Repository\Exported Certificates.Local Certificates<br />
The files to use are <code>client.pem</code> and <code>client_key.pem</code>. The config file can point straight to these files.<br />
Or export a new client cert/keys from the QMC and use these with Butler.</p>
</li>
</ul>
<h1 id="log4net_extender_config_files">log4net extender config files<a class="headerlink" href="#log4net_extender_config_files" title="Permanent link">&para;</a></h1>
<p>Butler includes a couple of xml files that when deployed to the Sense server will create real-time UDP messages for certain events (tasks failing, user sessions starting/ending etc).<br />
These xml files should be deployed as follows:  </p>
<ul>
<li>Task failure events  <ul>
<li>XML file found in log4net_task-failed/LocalLogConfig.xml. This file includes settings to both send an email, and a UDP message when a task fails.</li>
<li>XML file should be deployed to the server where reloads are done, in the C:\ProgramData\Qlik\Sense\Scheduler directory</li>
</ul>
</li>
<li>User audit events<ul>
<li>XML file found in log4net_user-audit-event/LocalLogConfig.xml</li>
<li>XML file should be deployed on the server where the proxy is running, in the C:\ProgramData\Qlik\Sense\Proxy directory</li>
<li>If there multiple proxies on different servers, it might make sense deploying the xml file on all of them, to capture all user audit events.</li>
</ul>
</li>
</ul>
<h1 id="customisation">Customisation<a class="headerlink" href="#customisation" title="Permanent link">&para;</a></h1>
<p>As Butler offers a rather diverse set of features, everyone might not need all features. There is no single config file in which individual features can be turned on/off, 
but given the structure of the Butler source code it is relatively easy to disable speciifc features, or add new ones.<br />
For example, to disable a particular REST API endpoint, you could just remove the registration of that endpoint from within the src/butler.js file.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../running/" class="btn btn-neutral float-right" title="Running Butler">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../project-layout/" class="btn btn-neutral" title="Project layout"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ptarmiganlabs/butler/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../project-layout/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../running/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
